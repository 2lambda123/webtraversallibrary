
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Examples &#8212; Web Traversal Library  documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/pyramid.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Main classes" href="references_main.html" />
    <link rel="prev" title="Getting started" href="gettingstarted.html" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head><body>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="references_main.html" title="Main classes"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="gettingstarted.html" title="Getting started"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Web Traversal Library  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Examples</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="examples">
<h1>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h1>
<div class="section" id="dataguy-by-element-py">
<h2>dataguy_by_element.py<a class="headerlink" href="#dataguy-by-element-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Clicks hard-coded menu items by element and selector.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab</span>
<span class="k">def</span> <span class="nf">policy</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">]:</span>
    <span class="c1"># Picking an action at random relating to one of these elements</span>
    <span class="n">elements</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span>
    <span class="n">menu_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elements</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="mi">200</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span><span class="p">]</span>
    <span class="n">actions_a</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Action</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_element</span><span class="p">(</span><span class="n">menu_elements</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Another way is doing it by selector - this one matches all the menu items (equivalent to the above)</span>
    <span class="n">actions_b</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Action</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_selector</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="n">css</span><span class="o">=</span><span class="s2">&quot;.sidenav div a&quot;</span><span class="p">))</span>

    <span class="c1"># Click the first menu item and then, before snapshotting, the second</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">actions_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">actions_b</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">workflow</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span> <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ActiveElementFilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Click</span><span class="p">))</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="dementor-py">
<h2>dementor.py<a class="headerlink" href="#dementor-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Remove an element, one at a time, until the page is empty.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab</span>
<span class="k">def</span> <span class="nf">policy</span><span class="p">(</span><span class="n">workflow</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">]]:</span>
    <span class="c1"># After seven deletions, start over from step 3</span>
    <span class="k">if</span> <span class="n">workflow</span><span class="o">.</span><span class="n">loop_idx</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Revert</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="c1"># Randomly pick one of the deleting actions</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_type</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Remove</span><span class="p">)),</span>
        <span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Wait</span><span class="p">(</span><span class="mf">0.25</span><span class="p">),</span>
        <span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Clear</span><span class="p">(</span><span class="n">viewport</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">WaitForUser</span><span class="p">(),</span>
    <span class="p">]</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">wf</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span> <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="n">wtl</span><span class="o">.</span><span class="n">ElementClassifier</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dementor&quot;</span><span class="p">,</span>
            <span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">highlight</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Remove</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="n">e</span><span class="p">,</span>  <span class="c1"># Will label _all_ elements removable</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">wf</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="dynamic-windows-py">
<h2>dynamic_windows.py<a class="headerlink" href="#dynamic-windows-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Dynamically handles multiple tabs and windows.</span>
<span class="sd">Creates new windows and/or tabs every iteration.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">choice</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>


<span class="k">def</span> <span class="nf">policy</span><span class="p">(</span><span class="n">workflow</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">,</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">]:</span>
    <span class="n">loop_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">loop_idx</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">window_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">loop_idx</span> <span class="o">//</span> <span class="mi">3</span>

    <span class="c1"># Every third tab, create a new window, otherwise use the latest window</span>
    <span class="k">if</span> <span class="n">window_idx</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">workflow</span><span class="o">.</span><span class="n">windows</span><span class="p">):</span>
        <span class="n">window</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">create_window</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">window_idx</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">window</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">windows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Create a window to a new Wikipedia number link</span>
    <span class="n">window</span><span class="o">.</span><span class="n">create_tab</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">loop_idx</span><span class="p">),</span> <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://en.wikipedia.org/wiki/</span><span class="si">{</span><span class="n">loop_idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Click a random clickable element in a random view/tab</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">choice</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_type</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Click</span><span class="p">))}</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">wf</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span>
        <span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span> <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://en.wikipedia.org/wiki/0&quot;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span>
    <span class="p">)</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ActiveElementFilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Click</span><span class="p">))</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">wf</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="fill-form-py">
<h2>fill_form.py<a class="headerlink" href="#fill-form-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Randomly fill all random text input fields on a page with a preset list of names.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">choice</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>
<span class="kn">from</span> <span class="nn">webtraversallibrary.actions</span> <span class="kn">import</span> <span class="n">Clear</span><span class="p">,</span> <span class="n">FillText</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab</span>
<span class="k">def</span> <span class="nf">goal</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="c1"># Find all elements we could fill in text on</span>
    <span class="n">targets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">action</span><span class="o">.</span><span class="n">target</span> <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_type</span><span class="p">(</span><span class="n">FillText</span><span class="p">)]</span>
    <span class="c1"># Get all their collective contents</span>
    <span class="n">texts</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">]</span>
    <span class="c1"># Stop running if they have all been filled</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">t</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">texts</span><span class="p">)</span>


<span class="n">content</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Robin Carpenter&quot;</span><span class="p">,</span> <span class="s2">&quot;Kenny Turner&quot;</span><span class="p">,</span> <span class="s2">&quot;Ernestine Ferguson&quot;</span><span class="p">,</span> <span class="s2">&quot;Marcelo Allen&quot;</span><span class="p">,</span> <span class="s2">&quot;Marilyn Rich&quot;</span><span class="p">,</span> <span class="s2">&quot;Rupert Strong&quot;</span><span class="p">]</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab</span>
<span class="k">def</span> <span class="nf">policy</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">]:</span>
    <span class="c1"># Filter out all the FillText actions where the element is still empty</span>
    <span class="n">fill_actions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">action</span> <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_type</span><span class="p">(</span><span class="n">FillText</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">action</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span>
    <span class="p">]</span>
    <span class="c1"># Randomly pick an action and a text</span>
    <span class="n">action</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Action</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">fill_actions</span><span class="p">)</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
    <span class="c1"># Execute</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">Clear</span><span class="p">(),</span> <span class="n">action</span><span class="p">(</span><span class="n">text</span><span class="p">)]</span>


<span class="k">def</span> <span class="nf">text_field_classifier_func</span><span class="p">(</span><span class="n">elements</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Elements</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">PageElement</span><span class="p">]:</span>
    <span class="c1"># For now, we consider all input fields where the type attribute has a specific value.</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elements</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;input&quot;</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">,</span> <span class="s2">&quot;password&quot;</span><span class="p">)]</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">workflow</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span>
        <span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span>
        <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span>
        <span class="n">goal</span><span class="o">=</span><span class="n">goal</span><span class="p">,</span>
        <span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://www.getharvest.com/signup&quot;</span><span class="p">,</span>
        <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># We just need a text field classifier, no need to consider what&#39;s active (all of them should be).</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="n">wtl</span><span class="o">.</span><span class="n">ElementClassifier</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;textfield&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">FillText</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">text_field_classifier_func</span><span class="p">,</span> <span class="n">highlight</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Workflow successful?&quot;</span><span class="p">,</span> <span class="n">workflow</span><span class="o">.</span><span class="n">success</span><span class="p">)</span>

    <span class="c1"># This is the last view, i.e. the one where goal() returned True</span>
    <span class="n">final_view</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">View</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Get all texts</span>
    <span class="n">final_texts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">action</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">final_view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_type</span><span class="p">(</span><span class="n">FillText</span><span class="p">)]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Names entered: &quot;</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">final_texts</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="gui-py">
<h2>gui.py<a class="headerlink" href="#gui-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Basic example of using WTL together with a graphical frontend.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># pylint: disable=global-statement</span>

<span class="kn">import</span> <span class="nn">tkinter</span> <span class="k">as</span> <span class="nn">tk</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Lock</span><span class="p">,</span> <span class="n">Thread</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="nn">tkinter</span> <span class="kn">import</span> <span class="n">font</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>

<span class="c1"># === THREAD SYNC ===</span>
<span class="c1"># Global variables used for communicating.</span>
<span class="c1"># Uses a single lock for everything.</span>
<span class="c1"># 0=Waiting for new view, 1=Update GUI image, 2=Waiting for new action</span>

<span class="n">data_lock</span> <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span>
<span class="n">current_view</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">current_action</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>


<span class="c1"># === WTL THREAD ===</span>
<span class="c1"># Running WTL in a separate thread (so GUI can run on the main thread).</span>
<span class="c1"># Very simple state machine that saves the current view and busy waits</span>
<span class="c1"># until an action has been set from the GUI.</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab</span>
<span class="k">def</span> <span class="nf">policy</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">:</span>
    <span class="k">global</span> <span class="n">state</span><span class="p">,</span> <span class="n">current_view</span>

    <span class="k">with</span> <span class="n">data_lock</span><span class="p">:</span>
        <span class="n">current_view</span> <span class="o">=</span> <span class="n">view</span>
        <span class="n">state</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">data_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">current_action</span>

        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">wtl_thread</span><span class="p">(</span><span class="n">cli_args</span><span class="p">):</span>
    <span class="n">workflow</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span> <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ActiveElementFilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Click</span><span class="p">,</span> <span class="n">highlight</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>


<span class="c1"># === GUI THREAD (MAIN) ===</span>
<span class="c1">#</span>

<span class="n">show_actives</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">current_filename</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>


<span class="k">def</span> <span class="nf">gui_thread</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets up the window with design and all callbacks.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">show_actives</span>

    <span class="n">window</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Tk</span><span class="p">()</span>
    <span class="n">window</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;WTL browser&quot;</span><span class="p">)</span>
    <span class="n">window</span><span class="o">.</span><span class="n">geometry</span><span class="p">(</span><span class="s2">&quot;1920x1080&quot;</span><span class="p">)</span>

    <span class="n">top_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">()</span>

    <span class="n">canvas</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Canvas</span><span class="p">(</span><span class="n">top_frame</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1280</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">1080</span><span class="p">)</span>
    <span class="n">canvas</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">show_actives</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">IntVar</span><span class="p">()</span>
    <span class="n">ch</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Checkbutton</span><span class="p">(</span><span class="n">top_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Show active elements&quot;</span><span class="p">,</span> <span class="n">variable</span><span class="o">=</span><span class="n">show_actives</span><span class="p">)</span>
    <span class="n">ch</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">)</span>

    <span class="n">small_font</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">listbox</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Listbox</span><span class="p">(</span><span class="n">top_frame</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">375</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">small_font</span><span class="p">)</span>
    <span class="n">listbox</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">)</span>

    <span class="n">label_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1400</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>
    <span class="n">label_frame</span><span class="o">.</span><span class="n">pack_propagate</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">desc_label</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">label_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Hello&quot;</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">wraplength</span><span class="o">=</span><span class="mi">1300</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>
    <span class="n">desc_label</span><span class="o">.</span><span class="n">pack</span><span class="p">()</span>
    <span class="n">label_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">()</span>
    <span class="n">top_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_element</span><span class="p">(</span><span class="n">mouse</span><span class="p">):</span>  <span class="c1"># pylint: disable=inconsistent-return-statements</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Look for the element at current coords with smallest bounds</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">point</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">mouse</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> <span class="n">mouse</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">data_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">current_view</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="n">smallest_element</span><span class="p">,</span> <span class="n">smallest_area</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">999999</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">current_view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">bounds</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">area</span> <span class="o">&lt;</span> <span class="n">smallest_area</span><span class="p">:</span>
                    <span class="n">smallest_area</span><span class="p">,</span> <span class="n">smallest_element</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">area</span><span class="p">,</span> <span class="n">e</span>

        <span class="k">return</span> <span class="n">smallest_element</span>

    <span class="k">def</span> <span class="nf">hover</span><span class="p">(</span><span class="n">mouse</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the top label when hovering over an element.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">nonlocal</span> <span class="n">desc_label</span>

        <span class="n">smallest_element</span> <span class="o">=</span> <span class="n">get_element</span><span class="p">(</span><span class="n">mouse</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">data_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">smallest_element</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">smallest_element</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;text&quot;</span><span class="p">]</span>
                <span class="n">desc_label</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">desc_label</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">double_clicked</span><span class="p">(</span><span class="n">mouse</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set action of the clicked element.</span>
<span class="sd">        Does not check if it&#39;s active or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">state</span><span class="p">,</span> <span class="n">current_action</span>

        <span class="n">smallest_element</span> <span class="o">=</span> <span class="n">get_element</span><span class="p">(</span><span class="n">mouse</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">data_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">smallest_element</span><span class="p">:</span>
                <span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">current_action</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Click</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[wtl-uid=&quot;</span><span class="si">{</span><span class="n">smallest_element</span><span class="o">.</span><span class="n">wtl_uid</span><span class="si">}</span><span class="s1">&quot;]&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">selected</span><span class="p">(</span><span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets action by clicking an element in the listbox.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">state</span><span class="p">,</span> <span class="n">current_action</span>
        <span class="k">nonlocal</span> <span class="n">listbox</span>

        <span class="k">with</span> <span class="n">data_lock</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">listbox</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">listbox</span><span class="o">.</span><span class="n">curselection</span><span class="p">()))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; (&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">current_action</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Click</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[wtl-uid=&quot;</span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s1">&quot;]&#39;</span><span class="p">))</span>

    <span class="c1"># Bind functions to the GUI objects</span>
    <span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Motion&gt;&quot;</span><span class="p">,</span> <span class="n">hover</span><span class="p">)</span>
    <span class="n">canvas</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Double-Button-1&gt;&quot;</span><span class="p">,</span> <span class="n">double_clicked</span><span class="p">)</span>
    <span class="n">listbox</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;&lt;ListboxSelect&gt;&gt;&quot;</span><span class="p">,</span> <span class="n">selected</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">upd_view</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks state and updates the GUI with screenshot and list of actions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">state</span><span class="p">,</span> <span class="n">current_view</span><span class="p">,</span> <span class="n">show_actives</span><span class="p">,</span> <span class="n">current_filename</span>
        <span class="k">nonlocal</span> <span class="n">img</span><span class="p">,</span> <span class="n">listbox</span>

        <span class="k">with</span> <span class="n">data_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">current_filename</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">state</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="n">listbox</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">current_view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_type</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Click</span><span class="p">):</span>
                    <span class="n">wtl_uid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">wtl_uid</span><span class="p">)</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span>
                    <span class="n">listbox</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">,</span> <span class="n">wtl_uid</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;first&quot;</span> <span class="k">if</span> <span class="n">show_actives</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;is_active&quot;</span>
                <span class="k">if</span> <span class="n">filename</span> <span class="o">!=</span> <span class="n">current_filename</span><span class="p">:</span>
                    <span class="n">current_filename</span> <span class="o">=</span> <span class="n">filename</span>
                    <span class="n">current_view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">screenshots</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">))</span>
                    <span class="n">img</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">PhotoImage</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">)</span>
                    <span class="n">canvas</span><span class="o">.</span><span class="n">create_image</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">NW</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">img</span><span class="p">)</span>

        <span class="n">window</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="n">upd_view</span><span class="p">)</span>

    <span class="n">window</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="n">upd_view</span><span class="p">)</span>
    <span class="n">window</span><span class="o">.</span><span class="n">mainloop</span><span class="p">()</span>


<span class="c1"># === === === === ===</span>
<span class="c1"># Entry point: Setup WTL thread and run GUI on this (main) thread.</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">_cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>
    <span class="n">_wtl_thread</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">wtl_thread</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">_cli_args</span><span class="p">,))</span>
    <span class="n">_wtl_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">gui_thread</span><span class="p">()</span>
    <span class="n">_wtl_thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="hard-coded-py">
<h2>hard_coded.py<a class="headerlink" href="#hard-coded-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Simple example showing a hard-coded generator of actions.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>
<span class="kn">from</span> <span class="nn">webtraversallibrary.actions</span> <span class="kn">import</span> <span class="n">Clear</span><span class="p">,</span> <span class="n">Click</span><span class="p">,</span> <span class="n">Highlight</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span><span class="p">,</span> <span class="n">start_server</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab_coroutine</span>
<span class="k">def</span> <span class="nf">policy</span><span class="p">():</span>
    <span class="c1"># Highlight some titles, and then click a menu item.</span>
    <span class="c1"># Once the generator is exhausted, workflow will interpret StopIteration as cancelling the tabs.</span>

    <span class="k">yield</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>
        <span class="k">yield</span> <span class="p">[</span><span class="n">Clear</span><span class="p">(),</span> <span class="n">Highlight</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;h2:nth-of-type(</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">) &gt; a&quot;</span><span class="p">))]</span>
    <span class="k">yield</span> <span class="n">Click</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="s2">&quot;h2:nth-of-type(1) &gt; a&quot;</span><span class="p">))</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">workflow</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span>
        <span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span> <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">start_server</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/blog&quot;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span>
    <span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="href-scorer-py">
<h2>href_scorer.py<a class="headerlink" href="#href-scorer-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Ranks all links on a page by the length of the HREF attribute.</span>
<span class="sd">Does nothing with them.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>
<span class="kn">from</span> <span class="nn">webtraversallibrary.actions</span> <span class="kn">import</span> <span class="n">Wait</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab</span>
<span class="k">def</span> <span class="nf">policy</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">):</span>
    <span class="c1"># Wait so that the classifier isn&#39;t run over and over again</span>
    <span class="k">return</span> <span class="n">Wait</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">url_length_classifier_func</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
    <span class="c1"># Score all elements with an href attribute with a score of the length of the href attribute</span>
    <span class="n">href_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">element</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elements</span> <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;href&quot;</span><span class="p">]]</span>
    <span class="k">return</span> <span class="p">[(</span><span class="n">element</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;href&quot;</span><span class="p">]))</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">href_elements</span><span class="p">]</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">workflow</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span> <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="n">wtl</span><span class="o">.</span><span class="n">ElementClassifier</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;url_length&quot;</span><span class="p">,</span>
            <span class="n">highlight</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">ScalingMode</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">,</span>
            <span class="n">highlight_color</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
            <span class="n">callback</span><span class="o">=</span><span class="n">url_length_classifier_func</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="interactive-py">
<h2>interactive.py<a class="headerlink" href="#interactive-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Simple example of an interactive &quot;game&quot;, as an old-style text RPG, for web traversal.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>

<span class="n">initials</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;You see a house. Above the door hangs a sign: &quot;</span><span class="p">,</span>
    <span class="s2">&quot;You are in an open field. You find a note that says: &quot;</span><span class="p">,</span>
    <span class="s2">&quot;You are inside an old cottage. On the wall you see something written: &quot;</span><span class="p">,</span>
    <span class="s2">&quot;You are standing in the wtl office. It is loud. One of the screens say: &quot;</span><span class="p">,</span>
    <span class="s2">&quot;Rain is pouring through the broken roof. The rain patters a sound. You make out: &quot;</span><span class="p">,</span>
<span class="p">]</span>


<span class="n">textfield_desc</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;A person appears and asks you for a name. He hands you a paper and pen to write with.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;An empty notepad really wants something to be written.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;You see a dusty whiteboard with a pen that still works.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;A piece of paper is asking you what is on your mind. You have a pen in your hand.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;A parchment and quill lie before you.&quot;</span><span class="p">,</span>
<span class="p">]</span>


<span class="n">vague_desc</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;You can see people in the distance.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Marketing people are ringing a bell.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Everything around you looks really clean.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;There are multiple paths forward.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;You see shadows lurking about far away. They look friendly.&quot;</span><span class="p">,</span>
<span class="p">]</span>


<span class="n">content_desc</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;A bleached old parchment says: &quot;</span><span class="p">,</span>
    <span class="s2">&quot;A pretty little note by your feet says: &quot;</span><span class="p">,</span>
    <span class="s2">&quot;You find an old metal bracelet with an inscription: &quot;</span><span class="p">,</span>
    <span class="s2">&quot;You are standing next to an old radio. It repeats over and over again: &quot;</span><span class="p">,</span>
    <span class="s2">&quot;A whisper is carried by the wind. It says: &quot;</span><span class="p">,</span>
<span class="p">]</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab_coroutine</span>
<span class="k">def</span> <span class="nf">policy</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> === === === </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">view</span> <span class="o">=</span> <span class="k">yield</span>
    <span class="n">initial</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">initials</span><span class="p">)</span>
    <span class="n">spoken</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">spoken</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">page_metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">initial</span><span class="si">}</span><span class="s1">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
            <span class="n">spoken</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&gt; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="n">action</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;help&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Available commands:</span><span class="se">\n</span><span class="s2">help: shows this message&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;navigate&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;jump&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;look&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;move&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;navigate&quot;</span> <span class="ow">or</span> <span class="n">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;jump&quot;</span><span class="p">:</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Navigate</span><span class="p">(</span><span class="n">cmd</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;look&quot;</span><span class="p">:</span>
            <span class="n">buttons</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_type</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Click</span><span class="p">)</span>
            <span class="n">textfields</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_type</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">FillText</span><span class="p">)</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
            <span class="n">texts</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">by_selector</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="s2">&quot;h1&quot;</span><span class="p">))</span>
                <span class="o">+</span> <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">by_selector</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="s2">&quot;h2&quot;</span><span class="p">))</span>
                <span class="o">+</span> <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">by_selector</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="s2">&quot;h3&quot;</span><span class="p">))</span>
                <span class="o">+</span> <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">by_selector</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">))</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">textfields</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">textfield_desc</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">buttons</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">vague_desc</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">texts</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">content_desc</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>

            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;click&quot;</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="n">elements</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">by_selector</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[value~=&quot;</span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s1">&quot;]&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">elements</span><span class="p">:</span>
                <span class="n">elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span> <span class="k">if</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">elements</span><span class="p">:</span>
                <span class="n">elements</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">by_selector</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">elements</span><span class="p">:</span>
                <span class="n">action</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Click</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">elements</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;move&quot;</span><span class="p">:</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_type</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Click</span><span class="p">))</span>
            <span class="n">initial</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">initials</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;write&quot;</span><span class="p">:</span>
            <span class="n">textfields</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_type</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">FillText</span><span class="p">)</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">textfields</span><span class="p">)(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">action</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I do not understand.&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">spoken</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">view</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">action</span>


<span class="k">def</span> <span class="nf">text_field_classifier_func</span><span class="p">(</span><span class="n">elements</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Elements</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">PageElement</span><span class="p">]:</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elements</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;input&quot;</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">,</span> <span class="s2">&quot;password&quot;</span><span class="p">)]</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">workflow</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span> <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ActiveElementFilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Click</span><span class="p">))</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="n">wtl</span><span class="o">.</span><span class="n">ElementClassifier</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;textfield&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">FillText</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">text_field_classifier_func</span><span class="p">,</span> <span class="n">highlight</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;wtl&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="largest-image-py">
<h2>largest_image.py<a class="headerlink" href="#largest-image-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Ranks all images on a page by their geometric size.</span>
<span class="sd">Clicks on the largest, then checks if the URL changed, then stops.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>
<span class="kn">from</span> <span class="nn">webtraversallibrary.actions</span> <span class="kn">import</span> <span class="n">Click</span>
<span class="kn">from</span> <span class="nn">webtraversallibrary.goals</span> <span class="kn">import</span> <span class="n">N_STEPS</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>

<span class="n">goal</span> <span class="o">=</span> <span class="n">N_STEPS</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab</span>
<span class="k">def</span> <span class="nf">policy</span><span class="p">(</span><span class="n">workflow</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">]:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">workflow</span><span class="o">.</span><span class="n">history</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">images_by_size</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">by_score</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">element</span><span class="p">:</span> <span class="n">element</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">area</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">Click</span><span class="p">(</span><span class="n">images_by_size</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">page_metadata</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">page_metadata</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">],</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">image_classifier_func</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">elem</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">elements</span> <span class="k">if</span> <span class="n">elem</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;img&quot;</span><span class="p">]</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">wf</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span>
        <span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span> <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span> <span class="n">goal</span><span class="o">=</span><span class="n">goal</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span>
    <span class="p">)</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ElementClassifier</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">highlight</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">image_classifier_func</span><span class="p">))</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">wf</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="monkeypatch-py">
<h2>monkeypatch.py<a class="headerlink" href="#monkeypatch-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Click any active element, but all links lead to Rome, literally, using workflow.monkeypatches.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">choice</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>
<span class="kn">from</span> <span class="nn">webtraversallibrary.actions</span> <span class="kn">import</span> <span class="n">Click</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab</span>
<span class="k">def</span> <span class="nf">policy</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">:</span>
    <span class="n">menu_actions</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_type</span><span class="p">(</span><span class="n">Click</span><span class="p">)</span><span class="o">.</span><span class="n">by_score</span><span class="p">(</span><span class="s2">&quot;is_active&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">choice</span><span class="p">(</span><span class="n">menu_actions</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">workflow</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span> <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">monkeypatches</span><span class="o">.</span><span class="n">set_default</span><span class="p">(</span><span class="s2">&quot;https://en.wikipedia.org/wiki/Rome&quot;</span><span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ActiveElementFilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="n">Click</span><span class="p">))</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="multiples-py">
<h2>multiples.py<a class="headerlink" href="#multiples-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Creates a total of three tabs in two windows, and clicks randomly on all of them.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">choice</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>


<span class="k">def</span> <span class="nf">policy</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">,</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">]:</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">choice</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_type</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Click</span><span class="p">))</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">view</span><span class="o">.</span><span class="n">values</span><span class="p">()}</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">workflow</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span>
        <span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span>
        <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span>
        <span class="n">url</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;first&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;A&quot;</span><span class="p">:</span> <span class="s2">&quot;www.uppsalahandkraft.se&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="s2">&quot;https://www.uppsalamodemassa.se&quot;</span><span class="p">},</span>
            <span class="s2">&quot;second&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="s2">&quot;shop.biskopsgarden.com&quot;</span><span class="p">},</span>
        <span class="p">},</span>
        <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ActiveElementFilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Click</span><span class="p">))</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="random-dataguy-memory-py">
<h2>random_dataguy_memory.py<a class="headerlink" href="#random-dataguy-memory-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Defines a subset of all active elements (menu items) and clicks randomly on those exactly once.</span>
<span class="sd">When they have all been clicked, abort the workflow.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">choice</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>
<span class="kn">from</span> <span class="nn">webtraversallibrary.actions</span> <span class="kn">import</span> <span class="n">Abort</span><span class="p">,</span> <span class="n">Click</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab</span>
<span class="k">def</span> <span class="nf">policy</span><span class="p">(</span><span class="n">workflow</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">:</span>
    <span class="k">if</span> <span class="s2">&quot;previous&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">view</span><span class="o">.</span><span class="n">metadata</span><span class="p">:</span>
        <span class="n">view</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;previous&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">workflow</span><span class="o">.</span><span class="n">js</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
            <span class="n">wtl</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">30</span><span class="p">,</span> <span class="s2">&quot;This is an annotation&quot;</span><span class="p">,</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">workflow</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">screenshots</span><span class="p">:</span>
            <span class="c1"># Create screenshot of previous actions with an emphasis on the latest</span>
            <span class="n">scr</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">new_screenshot</span><span class="p">(</span><span class="s2">&quot;history&quot;</span><span class="p">,</span> <span class="n">of</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">prev</span> <span class="ow">in</span> <span class="n">view</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;previous&quot;</span><span class="p">]:</span>
                <span class="n">scr</span><span class="o">.</span><span class="n">highlight</span><span class="p">(</span><span class="n">prev</span><span class="o">.</span><span class="n">bounds</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
            <span class="n">scr</span><span class="o">.</span><span class="n">highlight</span><span class="p">(</span>
                <span class="n">view</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;previous_action&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">bounds</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Latest action&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">scr</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">workflow</span><span class="o">.</span><span class="n">output_path</span><span class="p">)</span>

            <span class="c1"># Save screenshot of the current live view</span>
            <span class="n">workflow</span><span class="o">.</span><span class="n">scraper</span><span class="o">.</span><span class="n">capture_screenshot</span><span class="p">(</span><span class="s2">&quot;live&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">workflow</span><span class="o">.</span><span class="n">output_path</span><span class="p">)</span>

    <span class="c1"># Get all elements tagged as &quot;menu&quot;</span>
    <span class="n">menu_elements</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">by_score</span><span class="p">(</span><span class="s2">&quot;menu&quot;</span><span class="p">)</span>

    <span class="c1"># Filter out those we have already clicked on</span>
    <span class="n">menu_elements</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">menu_elements</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">view</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;previous&quot;</span><span class="p">]]</span>
    <span class="p">]</span>

    <span class="k">if</span> <span class="n">menu_elements</span><span class="p">:</span>
        <span class="c1"># If there are any left, click that and remember its text</span>
        <span class="n">element</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">menu_elements</span><span class="p">)</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">Click</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
        <span class="n">view</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;previous&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Otherwise, stop everything</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">Abort</span><span class="p">()</span>

    <span class="c1"># Return</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Here are the buttons I&#39;ve clicked: &quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">view</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;previous&quot;</span><span class="p">]])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Last time I did&quot;</span><span class="p">,</span> <span class="n">view</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;previous_action&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">action</span>


<span class="k">def</span> <span class="nf">menu_classifier_func</span><span class="p">(</span><span class="n">elements</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Elements</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">PageElement</span><span class="p">]:</span>
    <span class="c1"># The condition here is completely hard-coded for the given page.</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">elem</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">elements</span> <span class="k">if</span> <span class="n">elem</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="ow">and</span> <span class="n">elem</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="mi">200</span> <span class="ow">and</span> <span class="n">elem</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span><span class="p">]</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">wf</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span> <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ActiveElementFilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="n">Click</span><span class="p">))</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="n">wtl</span><span class="o">.</span><span class="n">ElementClassifier</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;menu&quot;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="n">Click</span><span class="p">,</span>
            <span class="n">subset</span><span class="o">=</span><span class="s2">&quot;is_active&quot;</span><span class="p">,</span>  <span class="c1"># Consider only active elements</span>
            <span class="n">highlight</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="n">menu_classifier_func</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">wf</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="random-dataguy-py">
<h2>random_dataguy.py<a class="headerlink" href="#random-dataguy-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Defines a subset of all active elements (menu items) and clicks randomly on those.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">choice</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>
<span class="kn">from</span> <span class="nn">webtraversallibrary.actions</span> <span class="kn">import</span> <span class="n">Click</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab</span>
<span class="k">def</span> <span class="nf">policy</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">:</span>
    <span class="n">menu_actions</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_type</span><span class="p">(</span><span class="n">Click</span><span class="p">)</span><span class="o">.</span><span class="n">by_score</span><span class="p">(</span><span class="s2">&quot;menu&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">choice</span><span class="p">(</span><span class="n">menu_actions</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">menu_classifier_func</span><span class="p">(</span><span class="n">elements</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Elements</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">PageElement</span><span class="p">]:</span>
    <span class="c1"># The condition here is completely hard-coded for the given page.</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">elem</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">elements</span> <span class="k">if</span> <span class="n">elem</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="ow">and</span> <span class="n">elem</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="mi">200</span> <span class="ow">and</span> <span class="n">elem</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span><span class="p">]</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">workflow</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span> <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ActiveElementFilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="n">Click</span><span class="p">))</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="n">wtl</span><span class="o">.</span><span class="n">ElementClassifier</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;menu&quot;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="n">Click</span><span class="p">,</span>
            <span class="n">subset</span><span class="o">=</span><span class="s2">&quot;is_active&quot;</span><span class="p">,</span>  <span class="c1"># Consider only active elements</span>
            <span class="n">highlight</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="n">menu_classifier_func</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="random-traversal-py">
<h2>random_traversal.py<a class="headerlink" href="#random-traversal-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Click on any random clickable element on a page.</span>
<span class="sd">Also demonstrates the use of postload_callbacks.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">choice</span><span class="p">,</span> <span class="n">random</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>
<span class="kn">from</span> <span class="nn">webtraversallibrary.actions</span> <span class="kn">import</span> <span class="n">Click</span><span class="p">,</span> <span class="n">Refresh</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab</span>
<span class="k">def</span> <span class="nf">policy</span><span class="p">(</span><span class="n">workflow</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">workflow</span><span class="o">.</span><span class="n">duplicate_loop_idx</span> <span class="o">==</span> <span class="n">workflow</span><span class="o">.</span><span class="n">loop_idx</span>

    <span class="c1"># With some small probabilty, refresh instead of clicking.</span>
    <span class="k">return</span> <span class="n">choice</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_type</span><span class="p">(</span><span class="n">Click</span><span class="p">))</span> <span class="k">if</span> <span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.95</span> <span class="k">else</span> <span class="n">view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_type</span><span class="p">(</span><span class="n">Refresh</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">set_duplicate_loop_idx</span><span class="p">(</span><span class="n">workflow</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">):</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">duplicate_loop_idx</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">loop_idx</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">wf</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span> <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ActiveElementFilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="n">Click</span><span class="p">))</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">postload_callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">set_duplicate_loop_idx</span><span class="p">,</span> <span class="n">wf</span><span class="p">))</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">wf</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="size-scorer-py">
<h2>size_scorer.py<a class="headerlink" href="#size-scorer-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Classifies active elements with a &quot;size score&quot; and then clicks some element with average size.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">choice</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>
<span class="kn">from</span> <span class="nn">webtraversallibrary.actions</span> <span class="kn">import</span> <span class="n">Click</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab</span>
<span class="k">def</span> <span class="nf">policy</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">choice</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_type</span><span class="p">(</span><span class="n">Click</span><span class="p">)</span><span class="o">.</span><span class="n">by_score</span><span class="p">(</span><span class="s2">&quot;size__average&quot;</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">size_classifier_func</span><span class="p">(</span><span class="n">elements</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Elements</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
    <span class="c1"># Computes a normalized size.</span>
    <span class="c1"># Note that this is not the simplest way of clicking the largest clickable element.</span>

    <span class="n">largest_area</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">area</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="n">element</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">element</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">area</span> <span class="o">/</span> <span class="n">largest_area</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;big&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="n">e</span><span class="p">,</span> <span class="n">score</span><span class="p">(</span><span class="n">e</span><span class="p">))</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elements</span> <span class="k">if</span> <span class="n">score</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.75</span><span class="p">],</span>
        <span class="s2">&quot;average&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="n">e</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">-</span> <span class="n">score</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elements</span> <span class="k">if</span> <span class="mf">0.25</span> <span class="o">&lt;</span> <span class="n">score</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.75</span><span class="p">],</span>
    <span class="p">}</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">workflow</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span> <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ActiveElementFilter</span><span class="p">())</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="n">wtl</span><span class="o">.</span><span class="n">ElementClassifier</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;size&quot;</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="s2">&quot;is_active&quot;</span><span class="p">,</span> <span class="n">highlight</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">Click</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">size_classifier_func</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="k">with</span> <span class="n">workflow</span><span class="p">:</span>
        <span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="tictactoe-py">
<h2>tictactoe.py<a class="headerlink" href="#tictactoe-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Plays TicTacToe online by using a simple AI implementation.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>
<span class="kn">from</span> <span class="nn">webtraversallibrary.actions</span> <span class="kn">import</span> <span class="n">Click</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>


<span class="k">def</span> <span class="nf">checkWin</span><span class="p">(</span><span class="n">board</span><span class="p">,</span> <span class="n">player</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="n">player</span> <span class="ow">and</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">player</span> <span class="ow">and</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">player</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">player</span> <span class="ow">and</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="n">player</span> <span class="ow">and</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="n">player</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">board</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">player</span> <span class="ow">and</span> <span class="n">board</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="n">player</span> <span class="ow">and</span> <span class="n">board</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">==</span> <span class="n">player</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">board</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">player</span> <span class="ow">and</span> <span class="n">board</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="n">player</span> <span class="ow">and</span> <span class="n">board</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="n">player</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">getAIMove</span><span class="p">(</span><span class="n">board</span><span class="p">,</span> <span class="n">nextMove</span><span class="p">,</span> <span class="n">aiPlayer</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">checkWin</span><span class="p">(</span><span class="n">board</span><span class="p">,</span> <span class="n">aiPlayer</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">checkWin</span><span class="p">(</span><span class="n">board</span><span class="p">,</span> <span class="s2">&quot;O&quot;</span> <span class="k">if</span> <span class="n">aiPlayer</span> <span class="o">==</span> <span class="s2">&quot;X&quot;</span> <span class="k">else</span> <span class="s2">&quot;X&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">)</span>

    <span class="n">free</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">board</span><span class="p">)</span> <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="s2">&quot; &quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">free</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">free</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">board</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">moves</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">free</span><span class="p">:</span>
        <span class="n">nextBoard</span> <span class="o">=</span> <span class="n">board</span><span class="p">[:]</span>
        <span class="n">nextBoard</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nextMove</span>
        <span class="n">score</span> <span class="o">=</span> <span class="n">getAIMove</span><span class="p">(</span><span class="n">nextBoard</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;X&quot;</span> <span class="k">if</span> <span class="n">nextMove</span> <span class="o">==</span> <span class="s2">&quot;O&quot;</span> <span class="k">else</span> <span class="s2">&quot;O&quot;</span><span class="p">),</span> <span class="n">aiPlayer</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">moves</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">score</span><span class="p">))</span>

    <span class="n">moves</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="n">nextMove</span> <span class="o">==</span> <span class="n">aiPlayer</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">moves</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">printBoard</span><span class="p">(</span><span class="n">board</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot; &quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;   &quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;   &quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab</span>
<span class="k">def</span> <span class="nf">policy</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">]:</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_score</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">start</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

    <span class="n">tiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">target</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_score</span><span class="p">(</span><span class="s2">&quot;tile&quot;</span><span class="p">)]</span>
    <span class="n">board</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot; &quot;</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tiles</span><span class="p">]</span>
    <span class="n">move</span> <span class="o">=</span> <span class="n">getAIMove</span><span class="p">(</span><span class="n">board</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">)</span>

    <span class="n">printBoard</span><span class="p">(</span><span class="n">board</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Clear</span><span class="p">(</span><span class="n">viewport</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Click</span><span class="p">(</span><span class="n">tiles</span><span class="p">[</span><span class="n">move</span><span class="p">[</span><span class="mi">0</span><span class="p">]])]</span>


<span class="k">def</span> <span class="nf">_start_btn</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elements</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;sync-task-cover&quot;</span> <span class="ow">and</span> <span class="s2">&quot;block&quot;</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;display&quot;</span><span class="p">]]</span>


<span class="k">def</span> <span class="nf">_tile_div</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">e</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elements</span>
        <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;span&quot;</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;ttt&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;div&quot;</span>
    <span class="p">]</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">workflow</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span>
        <span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span>
        <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span>
        <span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://stanfordnlp.github.io/miniwob-plusplus/html/miniwob/tic-tac-toe.html&quot;</span><span class="p">,</span>
        <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ActiveElementFilter</span><span class="p">())</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ActiveElementFilter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">_start_btn</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">Click</span><span class="p">))</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ActiveElementFilter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;tile&quot;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">_tile_div</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">Click</span><span class="p">))</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="util-py">
<h2>util.py<a class="headerlink" href="#util-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Not an example, just helper functions for the other examples.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">ArgumentParser</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>


<span class="k">def</span> <span class="nf">start_server</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">my_env</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">my_env</span><span class="p">[</span><span class="s2">&quot;FLASK_APP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;tests/site/flask_app.py&quot;</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="s2">&quot;python3 -m flask run&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="n">env</span><span class="o">=</span><span class="n">my_env</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">DEVNULL</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">DEVNULL</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;http://localhost:5000&quot;</span>


<span class="k">def</span> <span class="nf">parse_cli_args</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ArgumentParser</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parses CLI flags relevant for examples.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">ArgumentParser</span><span class="p">()</span>

    <span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="s2">&quot;Run parameters&quot;</span><span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--url&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;DEFAULT&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;URL to run the workflow on.&quot;</span><span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--output&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="n">Path</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Where to save the result locally. If save, remember to also add save flag for config.&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--windows&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="o">.</span><span class="n">SINGLE_TAB</span><span class="p">],</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Tab names (comma-separated). Use space separation for multiple windows.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--config&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Names of config files in config/, such as &quot;</span> <span class="s1">&#39;&quot;iphone_x_mobile&quot;, or key=value pairs.&#39;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cli_args</span><span class="o">.</span><span class="n">url</span> <span class="o">==</span> <span class="s2">&quot;DEFAULT&quot;</span><span class="p">:</span>
        <span class="n">cli_args</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">start_server</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">cli_args</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="view-classifier-py">
<h2>view_classifier.py<a class="headerlink" href="#view-classifier-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Clicks randomly on a page until _dataguy_ is not part of the URL anymore, using a ViewClassifier.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">choice</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Set</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>
<span class="kn">from</span> <span class="nn">webtraversallibrary.actions</span> <span class="kn">import</span> <span class="n">Annotate</span><span class="p">,</span> <span class="n">Clear</span><span class="p">,</span> <span class="n">Click</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab</span>
<span class="k">def</span> <span class="nf">goal</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
    <span class="c1"># Stop when we dataguy is not part of the URL</span>
    <span class="k">return</span> <span class="s2">&quot;dataguy&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">view</span><span class="o">.</span><span class="n">tags</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab</span>
<span class="k">def</span> <span class="nf">policy</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">]:</span>
    <span class="c1"># Do any random click</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">Clear</span><span class="p">(),</span>
        <span class="n">Annotate</span><span class="p">(</span>
            <span class="n">location</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Still dataguy&quot;</span><span class="p">,</span>
            <span class="n">background</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="n">choice</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">by_type</span><span class="p">(</span><span class="n">Click</span><span class="p">)),</span>
    <span class="p">]</span>


<span class="k">def</span> <span class="nf">dataguy_classifier_func</span><span class="p">(</span><span class="n">view</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">View</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="c1"># This will assign &quot;dataguy&quot; to a view if the URL contains that, otherwise &quot;other&quot;</span>
    <span class="c1"># It can be retreived with view.tags</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;dataguy&quot;</span> <span class="k">if</span> <span class="s2">&quot;dataguy&quot;</span> <span class="ow">in</span> <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">page_metadata</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;other&quot;</span><span class="p">}</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">workflow</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span> <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ActiveElementFilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="n">Click</span><span class="p">))</span>

    <span class="c1"># The syntax for a ViewClassifier is similar, but simpler</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ViewClassifier</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;dataguy&quot;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">dataguy_classifier_func</span><span class="p">))</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="wiki-game-py">
<h2>wiki_game.py<a class="headerlink" href="#wiki-game-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Click on any random clickable element on a page.</span>
<span class="sd">Also demonstrates the use of postload_callbacks.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">choice</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>
<span class="kn">from</span> <span class="nn">webtraversallibrary.actions</span> <span class="kn">import</span> <span class="n">Abort</span><span class="p">,</span> <span class="n">Click</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab_coroutine</span>
<span class="k">def</span> <span class="nf">policy</span><span class="p">():</span>
    <span class="n">workflow</span><span class="p">,</span> <span class="n">view</span> <span class="o">=</span> <span class="k">yield</span>

    <span class="c1"># Store Page A&#39;s URL</span>
    <span class="n">page_a_url</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">current_window</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">current_url</span>
    <span class="n">workflow</span><span class="p">,</span> <span class="n">view</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">Click</span><span class="p">(</span>
        <span class="n">choice</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">by_subtree</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="s2">&quot;div[id=&#39;bodyContent&#39;]&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">by_selector</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)))</span>
    <span class="p">)</span>

    <span class="c1"># Store Page B&#39;s URL</span>
    <span class="n">page_b_url</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">current_window</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">current_url</span>

    <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="c1"># Stores first paragraph from page B&#39;s body</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">description</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">by_selector</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="s2">&quot;div p:nth-of-type(1)&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">description</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="n">description</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">by_selector</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="s2">&quot;div p:nth-of-type(2)&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span>

    <span class="c1"># Limit the description to 50 characters to improve search</span>
    <span class="n">description_subset</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">description</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">49</span><span class="p">])</span>

    <span class="c1"># Navigate back to page A</span>
    <span class="n">workflow</span><span class="p">,</span> <span class="n">view</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Navigate</span><span class="p">(</span><span class="n">page_a_url</span><span class="p">)</span>

    <span class="n">link_to_click</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">by_selector</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="s2">&quot;input[type=&#39;submit&#39;]&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

    <span class="c1"># In the search bar in page A, fill text with description_subset and</span>
    <span class="c1"># click search to get search results for the descriptions</span>

    <span class="n">workflow</span><span class="p">,</span> <span class="n">view</span> <span class="o">=</span> <span class="k">yield</span> <span class="p">[</span>
        <span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">FillText</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="s2">&quot;input[type=&#39;search&#39;]&quot;</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">description_subset</span><span class="p">)),</span>
        <span class="n">Click</span><span class="p">(</span><span class="n">link_to_click</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="c1"># Store search result&#39;s URL</span>
    <span class="n">search_url</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">current_window</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">current_url</span>

    <span class="n">search_results</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">by_selector</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="s2">&quot;div[class=mw-search-result-heading] a&quot;</span><span class="p">))</span>

    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Go to first link in the search result</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">workflow</span><span class="p">,</span> <span class="n">view</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">Click</span><span class="p">(</span><span class="n">search_results</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Empty search results!!&quot;</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">Abort</span><span class="p">()</span>

    <span class="c1"># Check if landing URL equals PAGE B URL, if yes, break, else iterate and go to next link in the search result</span>
    <span class="c1"># untill the URL&#39;s match</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">workflow</span><span class="o">.</span><span class="n">current_window</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">current_url</span> <span class="o">==</span> <span class="n">page_b_url</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Woohoo!!!&quot;</span><span class="p">)</span>
            <span class="k">break</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">workflow</span><span class="p">,</span> <span class="n">view</span> <span class="o">=</span> <span class="k">yield</span> <span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Navigate</span><span class="p">(</span><span class="n">search_url</span><span class="p">),</span> <span class="n">Click</span><span class="p">(</span><span class="n">search_results</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])]</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Search result exhausted!!&quot;</span><span class="p">)</span>
            <span class="k">break</span>

        <span class="k">yield</span> <span class="kc">None</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">wf</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span>
        <span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span>
        <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span>
        <span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://en.wikipedia.org/wiki/Special:Random&quot;</span><span class="p">,</span>
        <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ActiveElementFilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="n">Click</span><span class="p">))</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ElementClassifier</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;textfield&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">FillText</span><span class="p">,</span> <span class="n">highlight</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">wf</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="without-workflow-py">
<h2>without_workflow.py<a class="headerlink" href="#without-workflow-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Goes to a random wikipage, finds &#39;n&#39; most common words in the article, where &#39;n&#39; being the number of</span>
<span class="sd">most common words that the user wants.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>

<span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>

<span class="n">window</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Window</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

<span class="c1"># Navigates to a Wiki article chosen at random</span>
<span class="n">window</span><span class="o">.</span><span class="n">scraper</span><span class="o">.</span><span class="n">navigate</span><span class="p">(</span><span class="s2">&quot;https://en.wikipedia.org/wiki/Special:Random&quot;</span><span class="p">)</span>

<span class="c1"># Takes a snapshot of the current page</span>
<span class="n">snapshot</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">scraper</span><span class="o">.</span><span class="n">scrape_current_page</span><span class="p">()</span>

<span class="c1"># Fetches all the elements with links in the current page</span>
<span class="n">links</span> <span class="o">=</span> <span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">by_selector</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">))</span>  <span class="c1"># pylint: disable=no-member</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of links in the article &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">links</span><span class="p">))</span>

<span class="c1"># Gets the current URL of the page</span>
<span class="n">search_url</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">current_url</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Link to the wiki article : &quot;</span><span class="p">,</span> <span class="n">search_url</span><span class="p">)</span>

<span class="n">paragraphs</span> <span class="o">=</span> <span class="n">snapshot</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">by_selector</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="s2">&quot;div p&quot;</span><span class="p">))</span>  <span class="c1"># pylint: disable=no-member</span>
<span class="n">article</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<span class="c1"># Fetch stopwords from a local file containing an array of stopwords</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;examples/stopwords.txt&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">stopwords</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paragraphs</span><span class="p">:</span>
    <span class="n">article</span> <span class="o">=</span> <span class="n">article</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span>

<span class="c1"># Find n most common words in the article, where n being the number of common words required by the user</span>

<span class="n">wordcount</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">article</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stopwords</span><span class="p">:</span>
        <span class="n">wordcount</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="n">n_print</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;How many most common words to print: &quot;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">OK. The </span><span class="si">{}</span><span class="s2"> most common words are as follows</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n_print</span><span class="p">))</span>
<span class="n">word_counter</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">(</span><span class="n">wordcount</span><span class="p">)</span>
<span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">word_counter</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="n">n_print</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="s2">&quot;: &quot;</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>

<span class="c1"># Close the browser</span>
<span class="n">window</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="zindex-py">
<h2>zindex.py<a class="headerlink" href="#zindex-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>

<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Compute the zIndex of all active elements and highlights the top 1% elements.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="kn">import</span> <span class="nn">webtraversallibrary</span> <span class="k">as</span> <span class="nn">wtl</span>
<span class="kn">from</span> <span class="nn">webtraversallibrary.logging_utils</span> <span class="kn">import</span> <span class="n">setup_logging</span>

<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">parse_cli_args</span>


<span class="nd">@wtl</span><span class="o">.</span><span class="n">single_tab</span>
<span class="k">def</span> <span class="nf">policy</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Action</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">WaitForUser</span><span class="p">()</span>


<span class="c1"># https://stackoverflow.com/questions/1388007/getting-the-z-index-of-a-div-in-javascript</span>
<span class="n">Z_INDEX_JS</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">window.getZIndex = function (e) {</span>
<span class="s2">  if (e === null) {</span>
<span class="s2">    return 0;</span>
<span class="s2">  }</span>
<span class="s2">  let z = window.document.defaultView.getComputedStyle(e).getPropertyValue(&#39;z-index&#39;);</span>
<span class="s2">  if (isNaN(z)) {</span>
<span class="s2">    return window.getZIndex(e.parentElement);</span>
<span class="s2">  }</span>
<span class="s2">  return z;</span>
<span class="s2">};</span>
<span class="s2">console.log(&quot;Hello!&quot;);</span>
<span class="s2">let element = document.querySelector(arguments[0]);</span>
<span class="s2">if (element !== null) {</span>
<span class="s2">  return window.getZIndex(element);</span>
<span class="s2">}</span>
<span class="s2">&quot;&quot;&quot;</span>


<span class="k">def</span> <span class="nf">_compute_z_index</span><span class="p">(</span><span class="n">elements</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Elements</span><span class="p">,</span> <span class="n">workflow</span><span class="p">:</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">wtl</span><span class="o">.</span><span class="n">PageElement</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
    <span class="c1"># This may be slow for many elements. If you need more performance, consider a JS script</span>
    <span class="c1"># which computes all elements&#39; z-values combined and returns the map directly.</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
        <span class="n">zIndex</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">js</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="n">Z_INDEX_JS</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">selector</span><span class="o">.</span><span class="n">css</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">e</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">zIndex</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parse_cli_args</span><span class="p">()</span>

    <span class="n">wf</span> <span class="o">=</span> <span class="n">wtl</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">cli_args</span><span class="o">.</span><span class="n">config</span><span class="p">),</span> <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">cli_args</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wtl</span><span class="o">.</span><span class="n">ActiveElementFilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Click</span><span class="p">))</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">classifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="n">wtl</span><span class="o">.</span><span class="n">ElementClassifier</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;zIndex&quot;</span><span class="p">,</span>
            <span class="n">subset</span><span class="o">=</span><span class="s2">&quot;is_active&quot;</span><span class="p">,</span>
            <span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">highlight</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">wtl</span><span class="o">.</span><span class="n">ScalingMode</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="n">_compute_z_index</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">setup_logging</span><span class="p">(</span><span class="n">logging_level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

    <span class="n">wf</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">wf</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Examples</a><ul>
<li><a class="reference internal" href="#dataguy-by-element-py">dataguy_by_element.py</a></li>
<li><a class="reference internal" href="#dementor-py">dementor.py</a></li>
<li><a class="reference internal" href="#dynamic-windows-py">dynamic_windows.py</a></li>
<li><a class="reference internal" href="#fill-form-py">fill_form.py</a></li>
<li><a class="reference internal" href="#gui-py">gui.py</a></li>
<li><a class="reference internal" href="#hard-coded-py">hard_coded.py</a></li>
<li><a class="reference internal" href="#href-scorer-py">href_scorer.py</a></li>
<li><a class="reference internal" href="#interactive-py">interactive.py</a></li>
<li><a class="reference internal" href="#largest-image-py">largest_image.py</a></li>
<li><a class="reference internal" href="#monkeypatch-py">monkeypatch.py</a></li>
<li><a class="reference internal" href="#multiples-py">multiples.py</a></li>
<li><a class="reference internal" href="#random-dataguy-memory-py">random_dataguy_memory.py</a></li>
<li><a class="reference internal" href="#random-dataguy-py">random_dataguy.py</a></li>
<li><a class="reference internal" href="#random-traversal-py">random_traversal.py</a></li>
<li><a class="reference internal" href="#size-scorer-py">size_scorer.py</a></li>
<li><a class="reference internal" href="#tictactoe-py">tictactoe.py</a></li>
<li><a class="reference internal" href="#util-py">util.py</a></li>
<li><a class="reference internal" href="#view-classifier-py">view_classifier.py</a></li>
<li><a class="reference internal" href="#wiki-game-py">wiki_game.py</a></li>
<li><a class="reference internal" href="#without-workflow-py">without_workflow.py</a></li>
<li><a class="reference internal" href="#zindex-py">zindex.py</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="gettingstarted.html"
                        title="previous chapter">Getting started</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="references_main.html"
                        title="next chapter">Main classes</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/examples.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="references_main.html" title="Main classes"
             >next</a> |</li>
        <li class="right" >
          <a href="gettingstarted.html" title="Getting started"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Web Traversal Library  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Examples</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020 Klarna Bank AB (publ).
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.5.4.
    </div>
  </body>
</html>